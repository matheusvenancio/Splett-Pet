<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/layout/template.xhtml">

	<h:head>
	<script src="/js/locale.js"/>
		<link href="/css/style.css" rel="stylesheet" type="text/css" />
		<f:metadata>
			<f:event type="preRenderView" listener="#{eventoMB.carregarOrgEvt}" />

			<f:event type="preRenderView"
				listener="#{organizacaoMB.listarAnimaisOrg(organizacaoMB.organizacao.id)}" />
				
					<f:event type="preRenderView"
				listener="#{eventoMB.carregarOrgEvt}" />
		</f:metadata>
	</h:head>

	<ui:define name="body">
		<h:form id="eventoForm">
		<h:outputScript name="locale.js" library="js" />   
			<h4 style="width: 40%">Anunciar um Evento</h4>
			<p:fieldset legend="Sobre o evento" toggleable="true"
				toggleSpeed="500">

				<h:panelGrid columns="3" styleClass="grid"
					style="margin-left: auto; margin-right: auto; width:40%">

					<h:outputText value="Nome do Evento: *" styleClass="f5"/>
					<p:inputText id="nomeTf" value="#{eventoMB.evento.titulo}"
						required="true" requiredMessage="O campo Nome é obrigatório" />
					<p:message for="nomeTf" display="both" />

					<p:separator />
					<p:separator />
					<p:separator />

					<h:outputLabel value="Data: *" styleClass="f5"/>
					<p:calendar id="dataInicioEvento" pattern="EEE dd/MM/yyyy HH:mm"
						value="#{eventoMB.evento.dataInicioEvento}" showOn="button"
						validatorMessage="Algo está errado aqui!" locale="pt_BR">
					</p:calendar>
					
					<p:message for="dataInicioEvento" display="both" />

					<p:separator />
					<p:separator />
					<p:separator />

					<h:outputLabel value="Data termino: *" styleClass="f5"/>
					<p:calendar id="dataTerminoEvento" pattern="EEE dd/MM/yyyy HH:mm"
						value="#{eventoMB.evento.dataTerminoEvento}" showOn="button"
						validatorMessage="Algo está errado aqui!" locale="pt_BR"  >
					<f:ajax event="blur" listener="#{eventoMB.validarDataEvento}"
					update="msgcpferro"/>
					</p:calendar>
					<p:message id="msgcpferro" for="dataTerminoEvento" display="both" />

					<p:separator />
					<p:separator />
					<p:separator />

					<h:outputText value="Descrição: *" styleClass="f5"/>
					<p:inputTextarea id="descricaoEvento"
						converter="ConverterEmptyToNull" label="descri"
						value="#{eventoMB.evento.descricao}" rows="8" cols="50"
						autoResize="false" counter="counter" maxlength="300"
						counterTemplate="{0} characters remaining." />
					<h:outputText id="counter" />
					<p:messages for="descricaoEvento" display="both" />

				</h:panelGrid>
			</p:fieldset>
			<p:separator />

			<h:panelGroup>
					<p:message for="fileUpload" showDetail="true" />
					<center>
						<p:fileUpload id="fileUpload"
							fileUploadListener="#{arquivoMB.uploadPbl}" mode="advanced"
							dragDropSupport="false" sizeLimit="20971520" auto="true"
							fileLimit="5" showButtons="false" update="imgs"
							allowTypes="/(\.|\/)(jpe?g|png)$/" label="Adicionar imagem"
							multiple="false" style="width:40%; display: none !important;" />
						<br />
						<p:dataTable id="imgs" value="#{arquivoMB.arquivos}" var="arq"
							paginator="false" rows="6"
							emptyMessage="Nenhuma imagem adicionada."
							styleClass="hide-column-names"
							selection="#{arquivoMB.arqSelecionado}">
							<p:column selectionMode="single" style="width:2%" />
							<p:column>
								<p:graphicImage value="/image?nome=#{arq.nome}"
									height="100" />
							</p:column>
							<p:column>
								<h:outputText value="#{arq.nomeReal}" />
							</p:column>
							<p:column>
								<p:commandButton action="#{arquivoMB.removerImgPreview}"
									update="imgs" icon="ui-icon-trash" title="Remover"
									process="@this">
									<f:setPropertyActionListener target="#{arquivoMB.arqView}"
										value="#{arq}" />
								</p:commandButton>
								<p:spacer width="20px" />
								<p:commandButton onclick="visualizarArq.show()"
									update="imgs :visualizarArquivoForm :visualizarArquivoForm:panelDialogArq"
									icon="ui-icon-search" title="Visualizar" process="@this">
									<f:setPropertyActionListener target="#{arquivoMB.arqView}"
										value="#{arq}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
					</center>
				</h:panelGroup>

			<p:separator />
			<p:fieldset legend="Local do Evento" toggleable="true"
				collapsed="true" toggleSpeed="500">
				<p:ajax event="toggle" listener="#{eventoMB.handleToggle}" />
				<h:panelGrid columns="2" styleClass="grid"
					style="margin-left: auto; margin-right: auto; width:40%">
					<h:outputText
						value="Estado: #{eventoMB.evento.endereco.estado.nome}" styleClass="f5"/>
					<h:panelGroup>
						<p:selectOneMenu id="estadoSelect" value="#{enderecoMB.estado}"
							effect="fade" converter="#{estadoConverter}"
							required="true"
							requiredMessage="Este Campo é obrigatório"
							style="font-size:8px; font-family:sans-serif">
							<f:selectItem itemLabel="Selecione" itemValue="" />
							<f:selectItems value="#{enderecoMB.estados}" var="est"
								itemLabel="#{est.nome}" itemValue="#{est}" />
							<f:ajax event="change"
								listener="#{enderecoMB.findCidadesByEstado}"
								render="cidadeSelect" />
						</p:selectOneMenu>
						<br />
					</h:panelGroup>

					<h:outputText
						value="Cidade: #{eventoMB.evento.endereco.cidade.nome}" styleClass="f5"/>
					<p:selectOneMenu id="cidadeSelect" value="#{enderecoMB.cidade}"
						effect="fade" converter="#{cidadeConverter}"
						required="true"
							requiredMessage="Este Campo é obrigatório"
						style="font-size:8px; font-family:sans-serif">
						<f:selectItem itemLabel="Selecione" itemValue="" />
						<f:selectItems value="#{enderecoMB.cidades}" var="cid"
							itemLabel="#{cid.nome}" itemValue="#{cid}" />
					</p:selectOneMenu>
					<br />

					<p:message display="both" for="bairroTf" />
					<h:outputText value="Bairro: " styleClass="f5"/>
					<p:inputText id="bairroTf" value="#{eventoMB.endereco.bairro}" required="true"
							requiredMessage="Este Campo é obrigatório" />

					<h:panelGroup>
						<h:outputText value="Logradouro: " styleClass="f5"/>
						<p:spacer width="20px" />
						<p:message for="logradouroTf" display="both" />
					</h:panelGroup>
					<p:inputText id="logradouroTf"
						value="#{eventoMB.endereco.logradouro}"
						validatorMessage=" - algo está errado aqui!"
						required="true"
							requiredMessage="Este Campo é obrigatório"
						converter="ConverterEmptyToNull">
						<f:validateLength maximum="80" />
					</p:inputText>

					<h:outputText value="Complemento: " styleClass="f5"/>
					<p:inputText id="complementoTf"
						value="#{eventoMB.endereco.complemento}" />
					<h:outputText value="Número: " styleClass="f5"/>
					<p:inputMask id="numeroTf" converter="ConverterEmptyToNull"
						value="#{eventoMB.endereco.numero}" mask="9?9999" maxlength="5"
						placeHolder=" " validatorMessage="Algo está errado aqui! " />

				</h:panelGrid>
			</p:fieldset>


			<p:fieldset legend="Vincular animais" toggleable="true"
				collapsed="true" toggleSpeed="500">
				<p:ajax event="toggle" listener="#{eventoMB.handleToggle}" />
				<p:pickList value="#{eventoMB.animaisEvento}" var="anl" style="width:250px"
					itemLabel="#{anl.nome}" itemValue="#{anl}" converter="#{animalConverter}" showSourceControls="true" 
					showTargetControls="true" showCheckbox="true"  
                    showSourceFilter="true" showTargetFilter="true"
                     filterMatchMode="contains">
					
        <f:facet name="sourceCaption">Animais da Organizacao</f:facet>  
        <f:facet name="targetCaption">Animais Vinculados</f:facet>  
        	  <p:column style="width:25%">  
            <p:graphicImage value="/image?nome=#{anl.imgMain.nome}" width="30" height="40" />  
        </p:column>  
          <p:column style="width:75%;">  
            #{anl.nome}  
        </p:column>  
				</p:pickList>
			</p:fieldset>
			<p:tab id="confirm" title="Confirmar">
				<p:panel header=" ">

					<h:panelGrid id="gridBotoes" columns="2">
						<p:commandButton id="salvarEvento" value="Salvar"
							action="#{eventoMB.salvar}" ajax="false" style="font-size:13px !important"/>

						<p:commandButton id="cancelarEventoBt" value="Cancelar" style="font-size:13px !important"
							immediate="true" action="#{eventoMB.cancelar}" />
					</h:panelGrid>
				</p:panel>
			</p:tab>

		</h:form>
		
		<p:dialog id="visualizarArquivo" widgetVar="visualizarArq"
			showHeader="false" modal="true" appendToBody="true" resizable="false"
			draggable="false" position="center" width="500" height="600">
			<h:form id="visualizarArquivoForm">
				<h:panelGrid id="panelDialogArq" columns="1" style="margin:0 auto;"
					styleClass="panelGrid">
					<h:outputText value="#{arquivoMB.arqView.nomeReal}"
						style="font-size: 16px !important; font-family: sans-serif" />
					<br />
					<center>
						<p:graphicImage id="imgViewDialog"
							value="/image?nome=#{arquivoMB.arqView.nome}" />
						<p:commandButton actionListener="#{arquivoMB.removerImgPreview}"
							update=":eventoForm:imgs" icon="ui-icon-trash"
							title="Visualizar" process="@this" onclick="visualizarArq.hide()" />
					</center>
				</h:panelGrid>
				<center>
					<p:commandButton onclick="visualizarArq.hide()" value="Fechar"
						update=":eventoForm:imgs" icon="ui-icon-close" title="Fechar" />
				</center>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>