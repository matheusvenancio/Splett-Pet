<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template.xhtml">
	<ui:define name="body">
		<h:form id="mensagensForm">

			<p:panelGrid style="width:70%; margin: 0 auto" columns="1" styleClass="semBorda">
				<p:row>
				<p:column>
					<p:button value="Nova Mensagem" outcome="escreverMensagem" style="width:200px; font-size:13px !important ">
						</p:button>
				</p:column>
					<p:column style="width:240px;">
						<p:commandButton id="caixaEntradaBt" value="Caixa de Entrada"
							actionListener="#{mensagemMB.findCaixaEntrada}"
							update="mensagens :msgForm" style="width:200px; font-size:12px !important" />
					</p:column>
					<p:column>
						<p:commandButton id="caixaSaidaBt" value="Caixa de Saída"
							actionListener="#{mensagemMB.findCaixaSaida}"
							update="mensagens :msgForm" style="width:200px; font-size:12px !important" />
					</p:column>
				</p:row>
					<p:row>
					<p:column>
						<p:dataTable id="mensagens" value="#{mensagemMB.msgs}" var="msg"
							paginator="true" rows="10"
							paginatorTemplate="{PreviousPageLink} {PageLinks} {NextPageLink}"
							selection="#{mensagemMB.mensagem}" selectionMode="single"
							emptyMessage="Não há nenhuma nova mensagem"
							paginatorPosition="bottom" style="text-align: center; font-size:13px !important">

							<p:ajax event="rowSelect" listener="#{mensagemMB.onRowSelect}"
								update="mensagens :msgForm" />
							<p:ajax event="rowUnselect" listener="#{mensagemMB.onRowSelect}"
								update="mensagens :msgForm" />

							<p:column style="width:50px;">
								<center>
									<h:outputText styleClass="ui-icon ui-icon-mail-closed"
										rendered="#{! msg.lida}" />
									<h:outputText styleClass="ui-icon ui-icon-mail-open"
										rendered="#{msg.lida}" />
								</center>
							</p:column>
							<p:column style="width:100px">
								<f:facet name="header">
									<h:outputText value="Data: " style="font-size:13px !important"/>
								</f:facet>
								<h:outputText value="#{msg.dataCadastro}"
									style="font-size:13px;">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>
							<p:column style="width:200px;">
								<f:facet name="header">
									<h:outputText value="De" style="font-size:13px !important"/>
								</f:facet>
								<h:outputText value="#{msg.remetente.nome}" style="font-size:13px !important"/>
							</p:column>
							<p:column>
								<f:facet name="header">
									<h:outputText value="Assunto" style="font-size:13px !important"/>
								</f:facet>
								<h:outputText value="#{msg.assunto}" style="font-size:13px !important"/>
							</p:column>
							<p:column style="width:50px">
								<p:commandButton action="#{mensagemMB.remover}"
									update="mensagens :msgForm:msgGrid" icon="ui-icon-trash"
									title="Remover" process="@this">
									<f:setPropertyActionListener target="#{mensagemMB.mensagem}"
										value="#{msg}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
					</p:column>
				</p:row>
				
			</p:panelGrid>
		</h:form>

		<h:form id="msgForm">
			<p:panelGrid id="msgGrid" style="width:70%; margin: 0 auto"
				rendered="#{mensagemMB.msgSelecionada}" styleClass="semBorda">
				<p:row>
					<p:column style="width:100px;">
						<h:outputText value="Assunto: " styleClass="f5" />
					</p:column>
					<p:column>
						<h:outputText value="#{mensagemMB.mensagem.assunto}" styleClass="f6"/>
					</p:column>
				</p:row>
				<p:row>
					<p:column>
						<h:outputText value="De: " styleClass="f5"/>
					</p:column>
					<p:column>
						<h:outputText value="#{mensagemMB.mensagem.remetente.nome}" styleClass="f6"/>
					</p:column>
				</p:row>
				<p:row>
					<p:column>
						<h:outputText value="Anexos: " styleClass="f5" />
					</p:column>
					<p:column>
						<p:dataTable value="#{mensagemMB.listarArquivosByMsg(mensagemMB.mensagem.id)}" var="anx" rows="5"
							type="none" emptyMessage="Nenhum anexo."
							style="width:20%; text-align: center; margin-top: 0px; font-size:13px !important">
							<p:column>
								<h:outputText value="#{anx.nomeReal}" styleClass="f6"/>
								<p:graphicImage value="/image?nome=#{anx.nome}" width="130" height="130"></p:graphicImage>
							</p:column>
						</p:dataTable>
					</p:column>
				</p:row>
				<p:row>
					<p:column colspan="2">
						<p:separator />
						<p:spacer width="50" />
						<h:outputText value="#{mensagemMB.mensagem.corpo}" styleClass="f6"/>
					</p:column>
				</p:row>
				<p:row>
					<p:column style="text-align:right !important;" colspan="2">
						<p:commandButton id="excluirMsgBt" value="remover"
							update=":mensagensForm:mensagens" icon="ui-icon-trash"
							style="font-size:16px !important; display: table-cell; vertical-align: bottom !important;"
							styleClass="fSmallCaps" actionListener="#{mensagemMB.remover}"/>
						<p:button value="responder" outcome="novaMensagem"
							style="float:right; font-size:16px !important; display: table-cell; vertical-align: bottom !important;"
							styleClass="fSmallCaps" icon="ui-icon-arrowrefresh-1-e">
							<f:param name="to" value="#{mensagemMB.mensagem.remetente.username}" />
						</p:button>
					</p:column>
				</p:row>
			</p:panelGrid>
		</h:form>

		<h:form id="responderMsgForm">
			<p:panel id="responderMsgPanel" header="Responder Mensagem"
				rendered="#{mensagemMB.isResponder}">
				<h:panelGrid columns="2">
					<h:outputText value="Assunto: " styleClass="f5" />
					<p:inputText value="#{mensagemMB.mensagem.assunto}" />

					<h:outputText value="Destinatario: " styleClass="f5"/>
					<h:outputText value="#{mensagemMB.usrDest.nome}" />

					<p:inputTextarea value="#{mensagemMB.mensagem.corpo}" />

					<p:commandButton id="EnviarMsg" value="Enviar"
						action="#{mensagemMB.salvar}" style="font-size:13px !important" />
				</h:panelGrid>
			</p:panel>
		</h:form>
	</ui:define>
</ui:composition>