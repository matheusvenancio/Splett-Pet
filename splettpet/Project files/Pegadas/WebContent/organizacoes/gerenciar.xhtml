<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template.xhtml">
	<h:head>
		<link href="/css/style.css" rel="stylesheet" type="text/css" />
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{organizacaoMB.loadGerenciarOrg}" />
			<f:event type="preRenderView"
				listener="#{organizacaoMB.listarUltimosEvtsOrg(organizacaoMB.organizacao.id)}" />
			<f:event type="preRenderView"
				listener="#{organizacaoMB.listarAnimaisOrg(organizacaoMB.organizacao.id)}" />
		</f:metadata>
	</h:head>
	<ui:define name="body">
	
	<h:form rendered="#{! usuarioMB.usuario.donoOrganizacao}" styleClass="alignCenter" style="width:300px">
		<p:panel>
			<h:outputText value="Voce nao possui uma organizacao!" styleClass="fonteErro" style="font-size:13px !important"/>
		</p:panel>
		</h:form>

		<h:form id="tabelaOrganizacoesForm" rendered="#{usuarioMB.usuario.donoOrganizacao}"
			style="visibility:visible !important;">

			<p:panelGrid columns="1" styleClass="grid, semBorda"
				style="margin-left: auto; margin-right: auto; width:70%; margin-top: 0 !important;"
				rendered="#{!organizacaoMB.editar and !organizacaoMB.gerVolunt}">

				<p:carousel rows="1" effect="easeInStrong" circular="true"
					headerText="Gerenciar #{organizacaoMB.organizacao.nome}"
					itemStyle="width:800px">
					<p:tab>
						<h:panelGrid columns="1" styleClass="alignCenter">
							<p:column>
								<p:graphicImage
									value="/image?nome=#{organizacaoMB.organizacao.imgMain.nome}" width="600" height="400"/>

							</p:column>
							<p:separator />
							<h:panelGroup>
								<h:outputText value="Nome: " styleClass="f5" />
								<h:outputText value="#{organizacaoMB.organizacao.nome}"
									styleClass="f6" />
							</h:panelGroup>
							<p:separator />
							<h:panelGroup>
								<h:outputText value="Localizacao: " styleClass="f5" />
								<h:outputText
									value="#{organizacaoMB.organizacao.enderecos.get(0).estado.nome}, #{organizacaoMB.organizacao.enderecos.get(0).cidade.nome}"
									styleClass="f6" />
							</h:panelGroup>
							<p:separator />
							<h:panelGroup>
								<h:outputText value="Presente desde: " styleClass="f5" />
								<h:outputText value="#{organizacaoMB.organizacao.dataCadastro}"
									styleClass="f6">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</h:panelGroup>
							<p:separator />
							<p:fieldset legend="Descricao" toggleable="true">
								<h:outputText value="#{organizacaoMB.organizacao.descricao} "
									styleClass="f6" />
							</p:fieldset>
							<p:separator />
							<p:fieldset legend="Proposta" toggleable="true">
								<h:outputText value="#{organizacaoMB.organizacao.proposta} "
									styleClass="f6" />
							</p:fieldset>

							<p:separator />
						</h:panelGrid>
					</p:tab>

					<p:tab>
						<h:panelGrid columns="1" styleClass="alignCenter">
							<p:dataTable value="#{organizacaoMB.eventos}" var="evt" rows="1"
								emptyMessage="Nenhum evento anunciado!">

								<f:facet name="header">Ultimo evento Anunciado</f:facet>
								<p:column>
									<p:graphicImage value="/image?nome=#{evt.imgMain.nome}"
										width="500" height="300" />
									<p:separator />
									<h:panelGrid columns="1" styleClass="semBorda">
										<h:outputText value="#{evt.titulo}" styleClass="f5" />
										<p:separator />
										<h:panelGroup styleClass="alignCenter">
											<h:outputText value="data de Inicio: " styleClass="f5" />
											<h:outputText value="#{evt.dataInicioEvento}" styleClass="f6">
												<f:convertDateTime pattern="dd/MM/yyyy 'as' HH:mm" />
											</h:outputText>
										</h:panelGroup>
										<p:separator />
										<h:panelGroup>
											<h:outputText value="data de Termino " styleClass="f5" />
											<h:outputText value="#{evt.dataTerminoEvento}"
												styleClass="f6">
												<f:convertDateTime pattern="dd/MM/yyyy 'as' HH:mm" />
											</h:outputText>
										</h:panelGroup>
										<p:separator />
										<h:panelGroup>
											<h:outputText value="Local do Evento: " styleClass="f5" />
											<h:outputText
												value="#{evt.endereco.cidade.nome}, rua #{evt.endereco.logradouro}, #{evt.endereco.numero}, bairro #{evt.endereco.bairro}"
												styleClass="f6">
												<f:convertDateTime pattern="dd/MM/yyyy 'as' HH:mm" />
											</h:outputText>
										</h:panelGroup>
										<p:separator />
										<p:separator />
										<h:panelGroup>
											<p:button id="pagEvento" outcome="evento"
												value="Visualizar Pagina" style="font-size:13px !important">
												<f:param name="id" value="#{evt.idPublicacao}" />
											</p:button>

											<p:button id="pagTodosEvts" outcome="eventos"
												value="Ver todos os Eventos"
												style="font-size:13px !important">
												<f:param name="id" value="#{organizacaoMB.organizacao.id}" />
											</p:button>
										</h:panelGroup>
									</h:panelGrid>
								</p:column>
							</p:dataTable>

						</h:panelGrid>
					</p:tab>

					<p:tab>
						<h:panelGrid columns="1" styleClass="alignCenter">
							<p:dataTable value="#{organizacaoMB.animais}" var="anl"
								emptyMessage="Nenhum animal cadastrado!" style="width:600px">
								<f:facet name="header">Animais Cadastrados</f:facet>
								<p:column>
									<p:outputPanel deferred="true" deferredMode="visible"
										style="width:600px; heigth:400px">
										<p>
											<h:panelGrid columns="2" styleClass="alignCenter" width="700">

												<p:column rowspan="2">

													<p:graphicImage value="/image?nome=#{anl.imgMain.nome}"
														id="imgAnl" width="150" height="100"
														styleClass="alignCenter" style="padding-left:40px">
														<p:tooltip for="imgAnl" showEffect="fade"
															hideEffect="fade">
															<p:panel>
																<p:panelGrid columns="1" styleClass="semBorda">
																	<f:facet name="header">
																		<h:outputText value="#{anl.nome}" styleClass="f5" />
																	</f:facet>
																	<h:panelGroup>
																		<h:outputText value="Cadastrado em: " styleClass="f5" />
																		<h:outputText value="#{anl.dataCadastro}"
																			styleClass="f6">
																			<f:convertDateTime pattern="dd/MM/yyyy" />
																		</h:outputText>
																	</h:panelGroup>
																	<h:panelGroup>
																		<h:outputText value="Por: " styleClass="f5" />
																		<h:outputText value="#{anl.usuario.nome}"
																			styleClass="f6">
																		</h:outputText>
																	</h:panelGroup>
																</p:panelGrid>
															</p:panel>

														</p:tooltip>
													</p:graphicImage>
												</p:column>

												<p:column>
													<p:button id="pagAnlOrgPerfil" outcome="animalOrg"
														value="Ver Perfil" style="font-size:13px !important">
														<f:param name="id" value="#{anl.id}" />
													</p:button>
												</p:column>

											</h:panelGrid>
										</p>
									</p:outputPanel>
								</p:column>
							</p:dataTable>
						</h:panelGrid>
					</p:tab>
				</p:carousel>

				<h:panelGrid columns="1" styleClass="alignCenter">
					<p:button value="Anunciar Evento" outcome="novoEvento"
						style="font-size:13px !important; margin-right: 0px !important;">

					</p:button>

				</h:panelGrid>
				<p:separator />

				<h:panelGrid columns="3" styleClass="alignCenter">
					<p:selectBooleanButton value="#{organizacaoMB.editar}"
						onLabel="Editar Informações" offLabel="Editar Informações"
						style="font-size:13px !important" immediate="true">
						<p:ajax update="@form :editarForm" />
					</p:selectBooleanButton>

					<p:selectBooleanButton value="#{organizacaoMB.gerVolunt}"
						onLabel="Gerenciar Voluntários" offLabel="Gerenciar Voluntários"
						style="font-size:13px !important" immediate="true">
						<p:ajax update="@form :voluntariosForm" />
					</p:selectBooleanButton>


					<p:button id="gerNecessidades" value="Gerenciar Necessidades"
						outcome="necessidades" style="font-size:13px !important">
						<f:param name="id" value="#{organizacaoMB.organizacao.id}" />
					</p:button>
				</h:panelGrid>
				<p:separator />
				<h:panelGrid columns="2" styleClass="alignCenter">
					<p:commandButton value="Cadastrar Animais"
						style="font-size:13px !important"
						action="#{animalMB.paginaCadastroAnimal}"></p:commandButton>

					<p:commandButton value="Fechar Organizacao" icon="ui-icon-trash"
						style="font-size:13px !important; color:red !important"
						onclick="confirmaDlg.show()">
						<f:setPropertyActionListener target="#{organizacaoMB.organizacao}"
							value="#{organizacaoMB.organizacao}" />
					</p:commandButton>
				</h:panelGrid>

			</p:panelGrid>

		</h:form>

		<h:form>
			<p:confirmDialog id="confirmationDialog" global="true"
				style="z-index:0 !important; color:red !important; font-size:13px !important"
				message="Deseja realmente fechar sua organizacao?" header="Aviso"
				widgetVar="confirmaDlg">
				<p:panel>
					<h:outputText
						value="Todos os dados, assim como cadastro de animais e eventos serao perdidos."
						styleClass="fonteErro" style="font-size:13px !important" />
				</p:panel>
				<p:commandButton value="Sim"
					actionListener="#{organizacaoMB.remover}"
					oncomplete="confirmaDlg.hide()" style="font-size:13px !important" />
				<p:commandButton value="Não"
					actionListener="#{organizacaoMB.cancelar}"
					style="font-size:13px !important" oncomplete="confirmaDlg.hide()" />
			</p:confirmDialog>
		</h:form>

		<!-- 
		
		<h:outputText value="Voluntários" />
				<p:dataList value="#{organizacaoMB.organizacao.voluntarios}"
					var="vol" itemType="disc">
					<h:outputText value="#{vol.nome}" />
				</p:dataList>
		 -->

		<h:form id="editarForm">
			<p:panelGrid columns="1" styleClass="grid"
				style="margin-left: auto; margin-right: auto; width:50%"
				rendered="#{organizacaoMB.editar}">
				<p:commandButton action="#{organizacaoMB.gerenciarVoltar}"
					update=":tabelaOrganizacoesForm @form"
					icon="ui-icon-arrowthick-1-w" title="Voltar" style="float: left;" />
				<h:panelGroup>
					<h:outputText value="Nome: *" />
					<p:spacer width="20px" />
					<p:message for="nomeOrgTf" display="both" />
				</h:panelGroup>
				<p:inputText id="nomeOrgTf"
					value="#{organizacaoMB.organizacao.nome}" required="true"
					requiredMessage=" este campo é obrigatório!" style="width:100%">
					<f:validateLength minimum="3" maximum="30" />
				</p:inputText>
				<p:separator />

				<h:panelGroup>
					<h:outputText value="Telefone: *" />
					<p:spacer width="20px" />
					<p:message for="telefoneOrgTf" display="both" />
				</h:panelGroup>
				<p:inputMask id="telefoneOrgTf" converter="ConverterEmptyToNull"
					value="#{organizacaoMB.organizacao.telefone}" mask="(99) 9999-9999"
					maxlength="10" placeHolder=" "
					validatorMessage=" - algo está errado aqui!" required="true"
					requiredMessage=" este campo é obrigatório!" />
				<p:separator />

				<h:panelGroup>
					<p:message for="fileUpload" showDetail="true" />
					<center>
						<p:fileUpload id="fileUpload"
							fileUploadListener="#{arquivoMB.uploadOrg}" mode="advanced"
							dragDropSupport="false" sizeLimit="20971520" auto="true"
							fileLimit="5" showButtons="false" update="imgs"
							allowTypes="/(\.|\/)(jpe?g|png)$/" label="Adicionar imagens"
							multiple="true" style="width:40%; display: none !important;" />
						<br />
						<p:dataTable id="imgs" value="#{arquivoMB.arquivos}" var="arq"
							paginator="false" rows="6"
							emptyMessage="Nenhuma imagem adicionada."
							styleClass="hide-column-names"
							selection="#{arquivoMB.arqSelecionado}">
							<p:column selectionMode="single" style="width:2%" />
							<p:column>
								<p:graphicImage value="/image?nome=#{arq.nome}" height="100" />
							</p:column>
							<p:column>
								<h:outputText value="#{arq.nomeReal}" />
							</p:column>
							<p:column>
								<p:commandButton action="#{arquivoMB.removerImgPreview}"
									update="imgs" icon="ui-icon-trash" title="Remover"
									process="@this">
									<f:setPropertyActionListener target="#{arquivoMB.arqView}"
										value="#{arq}" />
								</p:commandButton>
								<p:spacer width="20px" />
								<p:commandButton onclick="visualizarArq.show()"
									update="imgs :visualizarArquivoForm :visualizarArquivoForm:panelDialogArq"
									icon="ui-icon-search" title="Visualizar" process="@this">
									<f:setPropertyActionListener target="#{arquivoMB.arqView}"
										value="#{arq}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
					</center>
				</h:panelGroup>

				<h:panelGroup>
					<h:outputText value="Proposta: *" />
					<p:spacer width="20px" />
					<p:message for="propostaTf" display="both" />
				</h:panelGroup>
				<p:inputTextarea id="propostaTf" converter="ConverterEmptyToNull"
					required="true" value="#{organizacaoMB.organizacao.proposta}"
					rows="8" cols="50" autoResize="false" counter="counterProposta"
					maxlength="500" counterTemplate="{0} caracteres restantes."
					style="width:100%" />
				<h:outputText id="counterProposta" />
				<p:separator />

				<h:panelGroup>
					<h:outputText value="Descrição:  *" />
					<p:spacer width="20px" />
					<p:message for="descricaoTf" display="both" />
				</h:panelGroup>

				<p:inputTextarea id="descricaoTf" converter="ConverterEmptyToNull"
					required="true" value="#{organizacaoMB.organizacao.descricao}"
					rows="8" cols="50" autoResize="false" counter="counterDescricao"
					maxlength="500" counterTemplate="{0} caracteres restantes."
					style="width:100%" />
				<h:outputText id="counterDescricao" />
				<p:separator />
				<h:panelGrid>
					<!--  -->
					<p:commandLink value="Adicionar endereco"
						onclick="addEndDialog.show()" />

				</h:panelGrid>
				<!--  -->
				
				<p:commandButton value="cadastrar banco"
						onclick="cadastroBanco.show()" immediate="true"
						actionListener="#{bancoMB.novo}">
					</p:commandButton>
				
				
				<h:panelGroup>
					<h:outputText value="Agência: " />
					<p:spacer width="20px" />
					<p:message for="agenciaOrgTf" display="both" />
				</h:panelGroup>
				<p:inputMask id="agenciaOrgTf" converter="ConverterEmptyToNull"
					value="#{organizacaoMB.organizacao.numeroAgencia}" mask="9999-9"
					maxlength="8" placeHolder=" "
					validatorMessage=" - algo está errado aqui!" />
				<p:separator />

				<h:panelGroup>
					<h:outputText value="Conta: " />
					<p:spacer width="20px" />
					<p:message for="contaOrgTf" display="both" />
				</h:panelGroup>
				<p:inputMask id="contaOrgTf" converter="ConverterEmptyToNull"
					value="#{organizacaoMB.organizacao.numeroConta}" mask="99.999-9"
					maxlength="8" placeHolder=" "
					validatorMessage=" - algo está errado aqui!" />
				<p:separator />

				<h:panelGroup>
					<p:commandButton id="cancelarOrganizacaoBt" value="Cancelar"
						immediate="true" action="#{organizacaoMB.cancelar}" />

					<p:commandButton id="salvarOrganizacao" value="Salvar"
						action="#{organizacaoMB.salvar}" ajax="false" />
				</h:panelGroup>
			</p:panelGrid>
		</h:form>

		<h:form id="voluntariosForm">
			<p:panelGrid styleClass="grid" columns="1"
				style="margin-left: auto; margin-right: auto; width:50%"
				rendered="#{organizacaoMB.gerVolunt}">

				<p:commandButton action="#{organizacaoMB.gerenciarVoltar}"
					update=":tabelaOrganizacoesForm @form"
					icon="ui-icon-arrowthick-1-w" title="Voltar" style="float: left;" />
				<p:dataList value="#{organizacaoMB.organizacao.voluntarios}"
					var="vol" itemType="disc">
					<h:outputText value="#{vol.nome}" />
				</p:dataList>

				<p:selectBooleanButton value="#{organizacaoMB.addVolunt}"
					onLabel="adicionar voluntários" offLabel="adicionar voluntários"
					style="font-size:115%" styleClass="fSmallCaps" immediate="true"
					icon="ui-icon-arrowthick-1-w">
					<p:ajax update="addVoluntPanel" />
				</p:selectBooleanButton>
				<h:panelGroup id="addVoluntPanel">
					<p:panelGrid styleClass="grid" columns="1"
						style="margin-left: auto; margin-right: auto; width:100%"
						rendered="#{organizacaoMB.addVolunt}">
						<h:outputText
							value="Digite o e-mail do usuário para convidá-lo a #{organizacaoMB.organizacao.nome}: " />
						<p:message for="addVoluntEmailTf" />
						<p:inputText id="addVoluntEmailTf"
							value="#{organizacaoMB.emailAddVolunt}" required="true"
							requiredMessage=" este campo é obrigatório!" style="width:100%" />
						<p:commandButton id="btEnviar" value="enviar convite" update="addVoluntEmailTf"
							actionListener="#{organizacaoMB.addVoluntario}"
							icon="ui-icon-arrowthick-1-w" style="float: left;" />
							<p:blockUI block="voluntariosForm" trigger="btEnviar">
							<h:outputText value="enviando email" styleClass="fonteLaranja" style="font-size:'12px !important'"/>
							  <p:graphicImage value="/img/cao_gif.gif"/>  
							</p:blockUI>  
					</p:panelGrid>
				</h:panelGroup>
			</p:panelGrid>
		</h:form>

		<p:dialog id="dialogAddEnd" widgetVar="addEndDialog">

			<form>
				<h:panelGrid id="addEndPanel" columns="2">

					<h:outputText value="Bairro: " />
					<p:inputText value="#{organizacaoMB.endereco.bairro}"
						required="true" />

					<h:outputText value="Logradouro:  " />
					<p:inputText value="#{organizacaoMB.endereco.logradouro}"
						required="true" />
				</h:panelGrid>

				<p:commandButton id="salvarBt" value="Adicionar endereco"
					actionListener="#{organizacaoMB.salvarNovoEndereco}"
					onclick="addEndDialog.hide()" />
			</form>

		</p:dialog>

		<p:dialog id="visualizarArquivo" widgetVar="visualizarArq"
			showHeader="false" modal="true" appendToBody="true" resizable="false"
			draggable="false" position="center" width="500" height="600">
			<h:form id="visualizarArquivoForm">
				<h:panelGrid id="panelDialogArq" columns="1" style="margin:0 auto;"
					styleClass="panelGrid">
					<h:outputText value="#{arquivoMB.arqView.nomeReal}"
						style="font-size: 16px !important; font-family: sans-serif" />
					<br />
					<center>
						<p:graphicImage id="imgViewDialog"
							value="/image?nome=#{arquivoMB.arqView.nome}" />
						<p:commandButton actionListener="#{arquivoMB.removerImgPreview}"
							update=":editarForm:imgs" icon="ui-icon-trash" title="Visualizar"
							process="@this" onclick="visualizarArq.hide()" />
					</center>
				</h:panelGrid>
				<center>
					<p:commandButton onclick="visualizarArq.hide()" value="Fechar"
						update=":editarForm:imgs" icon="ui-icon-close" title="Fechar" />
				</center>
			</h:form>
		</p:dialog>
		<p:dialog id="bcCadastro" widgetVar="cadastroBanco" draggable="false"
			position="center" width="500" height="300">
			<h:form id="cadastrarBCForm">

				<h:panelGrid columns="1">
					<p:column>
						<h:outputText value="Banco suportado: *" styleClass="f5" />
						<!-- <p:inputText value="#{bancoMB.banco.nome}"></p:inputText> -->
						<p:selectOneRadio id="bancoOrg" required="true"
							requiredMessage="Este campo e obrigatorio" styleClass="f6"
							value="#{bancoMB.nomeBanco}">
							<f:selectItem itemValue="BANCOBRASIL" itemLabel="Banco do Brasil">
								<p:graphicImage value="/img/banco_do_brasil.gif" width="30%" />
							</f:selectItem>

							<f:selectItem itemValue="BRADESCO" itemLabel="Banco Bradesco">
								<h:graphicImage value="/img/icone_bradesco.gif" width="20%" />
							</f:selectItem>

						</p:selectOneRadio>

						<h:outputText value="Nosso Numero: *" styleClass="f5" />
						<p:message for="nossoNumMask" display="both" />
						<p:inputMask id="nossoNumMask" converter="ConverterEmptyToNull"
							required="true" requiredMessage="Campo obrigatorio"
							label="nossoNum" value="#{bancoMB.nossoNum}"
							validator="#{bancoMB.atribuirnossoNum}"
							mask="99999999999" maxlength="11" placeHolder=" " >
							<f:ajax event="blur" ></f:ajax>
							</p:inputMask>
						<p:separator />

						<h:outputText value="Numero de carteira: " styleClass="f5" />
						<p:spacer width="20px" />
						<p:message for="numCartMsk" display="both" />
						<p:inputMask id="numCartMsk" converter="ConverterEmptyToNull"
							required="true" requiredMessage="Campo obrigatorio"
							label="numCart" value="#{bancoMB.banco.numCarteira}" mask="99"
							maxlength="2" placeHolder=" " />
						<p:separator />

						<h:panelGroup>
							<h:outputText value="AgÍncia: " styleClass="f5" />
							<p:message for="agenciaOrgTf" display="both" />
						</h:panelGroup>
						<p:inputMask id="agenciaOrgTf" converter="ConverterEmptyToNull"
							value="#{bancoMB.banco.numeroAgencia}" mask="9999-9"
							required="true" requiredMessage="Campo obrigatorio" maxlength="8"
							placeHolder=" " validatorMessage=" - algo est· errado aqui!" />
						<p:separator />


						<h:outputText value="Conta: " styleClass="f5" />
						<p:message for="contaOrgTf" display="both" />
						<p:inputMask id="contaOrgTf" converter="ConverterEmptyToNull"
							required="true" requiredMessage="Campo obrigatorio"
							value="#{bancoMB.banco.numeroConta}" mask="99.999-9"
							maxlength="8" placeHolder=" "
							validatorMessage=" - algo est· errado aqui!" />





						<p:separator />
						<p:commandButton value="Salvar Banco" immediate="true"
							actionListener="#{bancoMB.salvarBancoEditar(organizacaoMB.organizacao.id)}"
							onclick="cadastroBanco.hide()" ></p:commandButton>
						<p:separator />
					</p:column>
				</h:panelGrid>

			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>